@using Microsoft.Extensions.Configuration;
@using Technical_Test.Services;
@using System.Collections; 
@inject IConfiguration Configuration

@model Technical_Test.Models.Car

@{
    ViewData["Title"] = "Add new car";
}

<h2>@ViewBag.Title</h2>
<h3>@ViewBag.Message</h3>

<section class="content jumbotron">
    @using (Html.BeginForm("newCar", "Car", FormMethod.Post))
    {

        <div class="form-group">
            @Html.LabelFor(m => m.Brand_id, "Brand")
            @Html.DropDownListFor(x => x.Brand_id, new SelectList(ViewBag.Brands as IEnumerable, "Value", "Text"),
                null, new { @class = "form-control", placeholder = "Select a brand", id="cbBrand" })

        </div>

        <div class="form-group">

            @Html.LabelFor(m => m.Model_id, "Model")
            @Html.DropDownListFor(x => x.Model_id, new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"),
                null, new { @class = "form-control", placeholder = "Select a brand", id="cbModel" })
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Price, "Price")
            @Html.TextBoxFor(m => m.Price, new { @class = "form-control", placeholder = "Set a price" })
        </div>

        <input type="submit" class="btn btn-primary" value="Add" />
    }
</section>

<script type="text/javascript">
    $(document).ready(function () {
        
        $("#cbBrand").change(function () {
            var dID = $(this).val();

            $.ajax({
                type: 'GET',
                url: '/Car/newCar/LoadModelsByIdBrand',
                data: { brand_id: dID },
                success: function (data) {
                    var select = $("#cbModel");
                    select.empty();
                    select.append($('<option/>', {
                        value: 0,
                        text: "Select a Model"
                    }));
                    $.each(data, function (index, itemData) {
                        select.append($('<option/>', {
                            value: itemData.Value,
                            text: itemData.Text
                        }));
                    });
                },
                dataType: "json"
            });

        });
    });
</script>
